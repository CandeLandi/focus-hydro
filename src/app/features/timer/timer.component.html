<p-dialog
  [visible]="sessionIntroVisible()"
  (onHide)="closeSessionIntro()"
  [modal]="true"
  [dismissableMask]="true"
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
  [breakpoints]="{ '575px': '90vw', '768px': '75vw' }"
  [style]="{ width: '50vw', maxWidth: '420px' }"
  [styleClass]="'session-intro-dialog'"
  baseZIndex="11000"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <div [ngClass]="isBreak() ? 'w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center border border-emerald-500/30' : 'w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-500/30'">
        <span class="pi text-lg" [ngClass]="isBreak() ? 'pi-glass text-emerald-300' : 'pi-bolt text-cyan-300'"></span>
      </div>
      <div>
        <h3 class="text-base font-semibold text-white m-0">{{ isBreak() ? 'Momento de Descanso' : 'Sesi贸n Pomodoro' }}</h3>
        <p class="text-xs text-slate-400 m-0 mt-0.5">{{ isBreak() ? 'Hidrataci贸n y recuperaci贸n' : 'Enfoque y productividad' }}</p>
      </div>
    </div>
  </ng-template>

  <div class="space-y-4 py-2">
    @if (!isBreak()) {
      <div class="space-y-3">
        <p class="text-sm leading-relaxed text-slate-200">
          25 minutos de foco absoluto, luego un respiro corto. Esa es la f贸rmula Pomodoro para mantenerte productivo sin quemarte.
        </p>
        <p class="text-sm leading-relaxed text-cyan-200/80">
          Elige tu pr贸xima misi贸n y conf铆a en el ritmo: cada bloque te acerca a tus metas. 
        </p>
      </div>
    } @else {
      <div class="space-y-3">
        <p class="text-sm leading-relaxed text-slate-200">
          Descansa, hidr谩tate y baja la velocidad. Este momento recarga tu energ铆a para el siguiente ciclo.
        </p>
        <p class="text-sm leading-relaxed text-emerald-200/80">
          Alarga un poco las piernas, toma agua y vuelve con la mente despejada. 
        </p>
      </div>
    }
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button
        label="Continuar"
        (onClick)="closeSessionIntro()"
        styleClass="!px-5 !py-2 !rounded-lg !bg-gradient-to-r !from-cyan-500 !via-cyan-400 !to-cyan-300 hover:!opacity-95 !text-slate-900 !text-sm !font-semibold !tracking-wide !shadow-lg !shadow-cyan-500/20">
      </p-button>
    </div>
  </ng-template>
</p-dialog>

<div class="flex flex-col lg:flex-row gap-4 h-full">
  <!-- Columna izquierda: Botella y controles -->
  <div class="flex flex-col lg:w-1/2 h-full">
    <div class="bg-slate-900 rounded-lg p-4 bg-gradient-to-br from-slate-900 via-slate-900 to-cyan-500/5 backdrop-blur border-2 border-cyan-500/20 shadow-2xl shadow-cyan-500/10 flex flex-col h-full">
      <div class="flex flex-col items-center justify-center gap-3 sm:gap-4 flex-1 w-full min-h-0 overflow-hidden">
        <!-- Marcador de sesi贸n -->
        <div class="flex items-center justify-center gap-2 text-xs text-slate-400 shrink-0">
          <span class="w-2 h-2 rounded-full bg-cyan-500 animate-pulse"></span>
          Sesi贸n {{ sessionsCompleted() + 1 }}
        </div>

        <div class="flex justify-center shrink-0 w-full">
          <div class="w-40 sm:w-48 md:w-52 lg:w-56 xl:w-72 2xl:w-80">
            <app-water-bottle [progress]="timerProgress()" [isBreak]="isBreak()" />
          </div>
        </div>

        <!-- Timer -->
        <div class="text-center space-y-1 sm:space-y-2 w-full shrink-0">
          <div class="text-[10px] sm:text-xs font-semibold text-cyan-400/80 uppercase tracking-wide">
            {{ isBreak() ? "Momento de Hidrataci贸n" : "Modo Concentraci贸n" }}
          </div>

          <div class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold font-mono tabular-nums bg-gradient-to-br from-cyan-500 via-cyan-400 to-cyan-300 bg-clip-text text-transparent drop-shadow-lg px-2 sm:px-4 py-1 sm:py-2">
            {{ formatTime(timeRemaining()) }}
          </div>
        </div>

        <!-- Controles -->
        <div class="flex items-center justify-center gap-3 w-full shrink-0">
        <button
          (click)="resetTimer()"
          class="flex-1 p-2 rounded-lg bg-slate-800/50 backdrop-blur border border-slate-700 hover:bg-slate-700 transition-colors flex items-center justify-center">
          <span class="pi pi-refresh text-cyan-200 text-lg leading-none"></span>
        </button>
        <button
          (click)="toggleTimer()"
          class="flex-[1.4] h-11 bg-gradient-to-r from-cyan-500/90 via-cyan-400/90 to-cyan-300/90 hover:opacity-95 transition-all shadow-lg shadow-cyan-500/20 rounded-lg flex items-center justify-center">
          <span [ngClass]="isRunning() ? 'pi pi-pause text-white text-xl' : 'pi pi-play text-white text-xl'"></span>
        </button>
        <button
          (click)="skipToBreak()"
          class="group flex-1 p-2 rounded-lg bg-gradient-to-br from-emerald-500/10 to-teal-500/10 backdrop-blur border border-emerald-500/20 hover:from-emerald-500/20 hover:to-teal-500/20 transition-all duration-300 relative overflow-hidden flex items-center justify-center">
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-emerald-400/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
          <span [ngClass]="skipActionIcon()"
                [class.text-emerald-300]="currentMode() === 'focus'"
                [class.text-amber-300]="currentMode() === 'break'"
                class="relative z-10 text-lg leading-none"></span>
          <div class="absolute -top-9 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-20">
            {{ currentMode() === 'focus' ? 'Saltar al descanso' : 'Volver al trabajo' }}
          </div>
        </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Columna derecha: Tareas -->
  <div class="flex flex-col lg:w-1/2 h-full">
    <div class="bg-slate-900 rounded-lg p-4 bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800/40 backdrop-blur border-2 border-cyan-500/10 shadow-2xl shadow-cyan-500/10 flex flex-col h-full overflow-hidden">
      <app-task-list class="flex-1 h-full min-h-0" [sessionsCompleted]="sessionsCompleted()" />
    </div>
  </div>
</div>

